var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},ExchangeRates=function(){function a(a,b,c){this.code=a,this.addCoordinate=b,this.update=c}return a.today=function(){var a=new Date,b=("0"+a.getDate()).slice(-2),c=("0"+(a.getMonth()+1)).slice(-2),d=a.getFullYear();return b+"/"+c+"/"+d},a.proxyUrl=function(a){return"https://jsonp.nodejitsu.com/?url="+encodeURIComponent(a)+"&raw=true"},a.prototype.url=function(){return"http://www.cbr.ru/scripts/XML_dynamic.asp?date_req1=22/06/2014&date_req2="+a.today()+"&VAL_NM_RQ="+this.code},a.prototype.fetch=function(){var b=this;$.ajax({url:a.proxyUrl(b.url()),type:"GET",crossDomain:!0,dataType:"xml",success:function(a){$(a).find("Record").each(function(){var a=$(this).attr("Date"),c=$(this).find("Value").text().replace(",",".");b.addCoordinate(a,+c)}),b.update()}})},a}(),USD=function(a){function b(b,c){a.call(this,"R01235",b,c)}return __extends(b,a),b}(ExchangeRates),EUR=function(a){function b(b,c){a.call(this,"R01239",b,c)}return __extends(b,a),b}(ExchangeRates),Journey=function(){function a(){this.latitudes={},this.longitudes={}}return a.prototype.addLatitude=function(a,b){this.latitudes[a]=b},a.prototype.addLongitudes=function(a,b){this.longitudes[a]=b},a.prototype.init=function(){var a=new google.maps.LatLng(46.6478,34.2797),b={zoom:12,center:a,mapTypeId:google.maps.MapTypeId.TERRAIN};this.map=new google.maps.Map(document.getElementById("map-canvas"),b)},a.prototype.run=function(){google.maps.event.addDomListener(window,"load",this.init.bind(this)),new EUR(this.addLatitude.bind(this),this.update.bind(this)).fetch(),new USD(this.addLongitudes.bind(this),this.update.bind(this)).fetch()},a.prototype.update=function(){var a=[];for(var b in this.latitudes)if(void 0!=this.longitudes[b]){var c=this.latitudes[b],d=this.longitudes[b],e=new google.maps.LatLng(c,d),f="<h2>"+b+"</h2>USD: "+c+"<br />EUR: "+d,g=new google.maps.Marker({position:e,map:this.map,title:f});a.push(e);var h=this;google.maps.event.addListener(g,"click",function(){var a=new google.maps.InfoWindow({content:this.getTitle()});a.open(h.map,this)})}if(a.length>0){var i=new google.maps.Polyline({path:a,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});i.setMap(this.map)}},a}(),j=new Journey;j.run();