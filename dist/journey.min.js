var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},ExchangeRates=function(){function a(a,b,c){this.code=a,this.addCoordinate=b,this.update=c}return a.today=function(){var a=new Date,b=("0"+a.getDate()).slice(-2),c=("0"+(a.getMonth()+1)).slice(-2),d=a.getFullYear();return b+"/"+c+"/"+d},a.prototype.url=function(){return"http://www.cbr.ru/scripts/XML_dynamic.asp?date_req1=22/06/2014&date_req2="+a.today()+"&VAL_NM_RQ="+this.code},a.prototype.fetch=function(){var a=this;$.ajax({url:a.url(),type:"GET",crossDomain:!0,dataType:"xml",success:function(b){$(b).find("Record").each(function(){var b=$(this).attr("Date"),c=$(this).find("Value").text().replace(",",".");a.addCoordinate(b,+c)}),a.update()}})},a}(),USD=function(a){function b(b,c){a.call(this,"R01235",b,c)}return __extends(b,a),b}(ExchangeRates),EUR=function(a){function b(b,c){a.call(this,"R01239",b,c)}return __extends(b,a),b}(ExchangeRates),Journey=function(){function a(){this.latitudes={},this.longitudes={}}return a.prototype.addLatitude=function(a,b){this.latitudes[a]=b},a.prototype.addLongitudes=function(a,b){this.longitudes[a]=b},a.prototype.init=function(){var a=new google.maps.LatLng(61.4108,49.322),b={zoom:4,center:a,mapTypeId:google.maps.MapTypeId.TERRAIN};this.map=new google.maps.Map(document.getElementById("map-canvas"),b)},a.prototype.run=function(){google.maps.event.addDomListener(window,"load",this.init.bind(this)),new EUR(this.addLatitude.bind(this),this.update.bind(this)).fetch(),new USD(this.addLongitudes.bind(this),this.update.bind(this)).fetch()},a.prototype.update=function(){for(var a in this.latitudes)if(void 0!=this.longitudes[a]){var b=this.latitudes[a],c=this.longitudes[a],d=new google.maps.LatLng(b,c),e="<h2>"+a+"</h2>USD: "+b+"<br />EUR: "+c,f=new google.maps.Marker({position:d,map:this.map,title:e}),g=this;google.maps.event.addListener(f,"click",function(){var a=new google.maps.InfoWindow({content:this.getTitle()});a.open(g.map,this)})}},a}(),j=new Journey;j.run();